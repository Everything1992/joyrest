<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - Joy - Pizza & Pasta</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://js.stripe.com/v3/"></script> <!-- Stripe JS -->
    <style>
      /* Basic styles for the checkout page */
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        color: #333;
        background-color: #f8f8f8;
      }

      /* Navigation Bar Styles */
      .navbar {
        background-color: #d4af37; /* Changed to yellow color */
        padding: 10px;
        text-align: center;
      }

      .navbar a {
        color: white;
        text-decoration: none;
        padding: 14px 20px;
        margin: 0 10px;
        font-size: 1.2em;
      }

      .navbar a:hover {
        background-color: #c0941a; /* Slightly darker yellow for hover effect */
        color: white;
      }

      .checkout-container {
        padding: 20px;
        max-width: 800px;
        margin: 20px auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .checkout-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
      }

      .cart-item img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        margin-right: 10px;
      }

      .total-price {
        font-size: 1.5em;
        text-align: center;
        margin-top: 20px;
      }

      .form-group {
        margin: 20px 0;
      }

      input[type="text"],
      input[type="email"],
      input[type="number"],
      button {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        border: 1px solid #ddd;
      }

      button {
        background-color: #d4af37; /* Button yellow color */
        color: white;
        cursor: pointer;
      }

      button:hover {
        background-color: #c0941a; /* Darker yellow for hover effect */
      }

      /* Responsive design for mobile */
      @media (max-width: 768px) {
        .checkout-container {
          padding: 15px;
        }

        .checkout-header h2 {
          font-size: 1.5em;
        }

        .total-price {
          font-size: 1.2em;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        button {
          padding: 8px;
          font-size: 1em;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <div class="navbar">
      <a href="https://everything1992.github.io/joyrest/menu.html">Menu</a>
      <a href="https://everything1992.github.io/joyrest/joyrest.html">Home</a>
    </div>

    <div class="checkout-container">
      <div class="checkout-header">
        <h2>Review Your Order</h2>
        <p>Check your items and enter payment details</p>
      </div>

      <div id="cart-items-container"></div>

      <div class="total-price">
        Total: $<span id="total-price">0.00</span>
      </div>

      <div class="form-group">
        <input type="text" id="name" placeholder="Your Name" required />
      </div>

      <div class="form-group">
        <input type="email" id="email" placeholder="Your Email" required />
      </div>

      <div class="form-group">
        <input type="number" id="phone" placeholder="Your Phone Number" required />
      </div>

      <!-- Payment Method Selection -->
      <div class="form-group">
        <label for="payment-method">Payment Method</label>
        <select id="payment-method" required>
          <option value="card">Credit/Debit Card</option>
          <option value="ebt">EBT (Electronic Benefits Transfer)</option>
        </select>
      </div>

      <!-- Stripe Payment Form (Only shows if Credit/Debit Card is selected) -->
      <div class="form-group" id="stripe-card-container" style="display: none;">
        <label for="card-element">Credit or Debit Card</label>
        <div id="card-element"></div> <!-- Stripe's Card Element will go here -->
        <div id="card-errors" role="alert"></div> <!-- Display errors from Stripe -->
      </div>

      <!-- EBT Payment Information (Only shows if EBT is selected) -->
      <div class="form-group" id="ebt-info-container" style="display: none;">
        <label for="ebt-number">EBT Number</label>
        <input type="text" id="ebt-number" placeholder="Enter your EBT number" />
      </div>

      <button id="complete-order-btn">Complete Order</button>
    </div>

    <script>
      // Initialize Stripe
      const stripe = Stripe('your-publishable-key-here'); // Replace with your Stripe publishable key
      const elements = stripe.elements();
      const card = elements.create('card');
      card.mount('#card-element'); // Mount the card element to the page

      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalPriceElement = document.getElementById('total-price');
      let total = 0;

      // Calculate total
      cart.forEach(item => {
        total += item.price * item.quantity;
      });
      totalPriceElement.textContent = total.toFixed(2);

      // Show/Hide Payment Method Inputs
      document.getElementById('payment-method').addEventListener('change', function() {
        const paymentMethod = this.value;
        if (paymentMethod === 'card') {
          document.getElementById('stripe-card-container').style.display = 'block';
          document.getElementById('ebt-info-container').style.display = 'none';
        } else if (paymentMethod === 'ebt') {
          document.getElementById('stripe-card-container').style.display = 'none';
          document.getElementById('ebt-info-container').style.display = 'block';
        }
      });

      // Handle form submission
      document.getElementById('complete-order-btn').addEventListener('click', function() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const paymentMethod = document.getElementById('payment-method').value;
        const ebtNumber = document.getElementById('ebt-number').value;

        if (name && email && phone && (paymentMethod === 'card' || (paymentMethod === 'ebt' && ebtNumber))) {
          if (paymentMethod === 'card') {
            // Create a Payment Method using Stripe
            stripe.createPaymentMethod({
              type: 'card',
              card: card,
            }).then((result) => {
              if (result.error) {
                // Display error in case of failure
                const errorElement = document.getElementById('card-errors');
                errorElement.textContent = result.error.message;
              } else {
                // Payment method created successfully
                const paymentMethodId = result.paymentMethod.id;

                // Here you would typically send the paymentMethodId to your server for payment processing
                // For now, we will just simulate a successful order
                alert('Your order has been placed successfully!');

                // Clear cart after order completion
                localStorage.removeItem('cart');
                window.location.href = 'index.html'; // Redirect to homepage or thank you page
              }
            });
          } else if (paymentMethod === 'ebt') {
            // Handle EBT payment submission (you can add logic to process EBT here)
            alert('Your order has been placed successfully with EBT payment!');

            // Clear cart after order completion
            localStorage.removeItem('cart');
            window.location.href = 'index.html'; // Redirect to homepage or thank you page
          }
        } else {
          alert('Please fill in all fields.');
        }
      });
    </script>
  </body>
</html>
